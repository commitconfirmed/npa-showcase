---
- name: Extract SSH keys from all hosts in your inventory and Import them
  hosts: localhost
  connection: local

  vars:
    ssh_hosts: "{{groups['all'] | map('extract', hostvars, ['ansible_host'])}}"

  tasks:
  - name: Get SSH Key
    shell: "ssh-keyscan -H {{item}}"
    with_items: "{{ssh_hosts}}"
    register: ssh_key
    ignore_errors: yes

  - name: Import Keys into known_hosts
    known_hosts:
      name: "{{ item.item }}"
      key: "{{ item.stdout }}"
      path: /home/ansible/.ssh/known_hosts
    with_items: "{{ ssh_key.results }}"
