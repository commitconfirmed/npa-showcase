# A Basic BGP anycast lab
name: ceos-anycast

mgmt:
  network: management
  ipv4-subnet: 172.20.0.0/24

topology:
  nodes:
    serv-ansible:
      kind: linux
      image: cc-ansible:latest
      mgmt-ipv4: 172.20.0.20
    ceos-spine1:
      kind: ceos
      image: ceos:4.28.10.1M
      mgmt-ipv4: 172.20.0.101
      env:
        CLAB_MGMT_VRF: MGMT
    ceos-spine2:
      kind: ceos
      image: ceos:4.28.10.1M
      mgmt-ipv4: 172.20.0.102
      env:
        CLAB_MGMT_VRF: MGMT
    ceos-leaf1:
      kind: ceos
      image: ceos:4.28.10.1M
      mgmt-ipv4: 172.20.0.111
      env:
        CLAB_MGMT_VRF: MGMT
    ceos-leaf2:
      kind: ceos
      image: ceos:4.28.10.1M
      mgmt-ipv4: 172.20.0.112
      env:
        CLAB_MGMT_VRF: MGMT
    ceos-leaf3:
      kind: ceos
      image: ceos:4.28.10.1M
      mgmt-ipv4: 172.20.0.113
      env:
        CLAB_MGMT_VRF: MGMT
    ceos-leaf4:
      kind: ceos
      image: ceos:4.28.10.1M
      mgmt-ipv4: 172.20.0.114
      env:
        CLAB_MGMT_VRF: MGMT
    bird-serv1:
      kind: linux
      image: cc-bird:latest
      mgmt-ipv4: 172.20.0.121
      exec:
        - "ip addr add 10.254.1.2/24 brd 10.254.1.255 dev eth1"
        - "ip addr add 172.16.1.1/32 dev lo"
        - "ip link set dev eth1 up"
    bird-serv2:
      kind: linux
      image: cc-bird:latest
      mgmt-ipv4: 172.20.0.122
      exec:
        - "ip addr add 10.254.2.2/24 brd 10.254.2.255 dev eth1"
        - "ip addr add 172.16.1.1/32 dev lo"
        - "ip link set dev eth1 up"
    bird-serv3:
      kind: linux
      image: cc-bird:latest
      mgmt-ipv4: 172.20.0.123
      exec:
        - "ip addr add 10.254.3.2/24 brd 10.254.3.255 dev eth1"
        - "ip addr add 172.16.1.1/32 dev lo"
        - "ip link set dev eth1 up"
    bird-serv4:
      kind: linux
      image: cc-bird:latest
      mgmt-ipv4: 172.20.0.124
      exec:
        - "ip addr add 10.254.4.2/24 brd 10.254.4.255 dev eth1"
        - "ip addr add 172.16.1.1/32 dev lo"
        - "ip link set dev eth1 up"
    ceos-bdr1:
      kind: ceos
      image: ceos:4.28.10.1M
      mgmt-ipv4: 172.20.0.201
      env:
        CLAB_MGMT_VRF: MGMT
    ubu-host1:
      kind: linux
      image: cc-host:latest
      mgmt-ipv4: 172.20.0.202
      exec:
        - "ip addr add 172.16.10.2/24 brd 172.16.10.255 dev eth1"
        - "ip -6 addr add 2001:db8:a10::2/48 dev eth1"
        - "ip link set dev eth1 up"
        - "ip route add 172.16.0.0/16 via 172.16.10.1 dev eth1"
        - "ip -6 route add default via 2001:db8:a10::1 dev eth1"

  links:
    - endpoints: ["ceos-spine1:eth1", "ceos-leaf1:eth1"]
    - endpoints: ["ceos-spine1:eth2", "ceos-leaf2:eth1"]
    - endpoints: ["ceos-spine1:eth3", "ceos-leaf3:eth1"]
    - endpoints: ["ceos-spine1:eth4", "ceos-leaf4:eth1"]
    - endpoints: ["ceos-spine2:eth1", "ceos-leaf1:eth2"]
    - endpoints: ["ceos-spine2:eth2", "ceos-leaf2:eth2"]
    - endpoints: ["ceos-spine2:eth3", "ceos-leaf3:eth2"]
    - endpoints: ["ceos-spine2:eth4", "ceos-leaf4:eth2"]
    - endpoints: ["bird-serv1:eth1", "ceos-leaf1:eth5"]
    - endpoints: ["bird-serv2:eth1", "ceos-leaf2:eth5"]
    - endpoints: ["bird-serv3:eth1", "ceos-leaf3:eth5"]
    - endpoints: ["bird-serv4:eth1", "ceos-leaf4:eth5"]
    - endpoints: ["ceos-bdr1:eth1", "ceos-spine1:eth5"]
    - endpoints: ["ceos-bdr1:eth2", "ceos-spine2:eth5"]
    - endpoints: ["ubu-host1:eth1", "ceos-bdr1:eth5"]